#Requires AutoHotkey v2.0
#include ImagePut.ahk

; embed tray icons as base64 string into AHK script
UseBase64TrayIcon(name := "transparent", debug := false) {
	icons := {
		bell: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAVpJREFUWEftl22KhDAMhhvQe7g3WW8yQit4ipk9hWCFdU+yc5P1HgoZC84gnbS1H4t/7N9a3ifp2yQCO3jBwfosCqBt2yLLskIIcQ8NJBhASvnLGPtUwgAwcs4/QiCCAKSU10XspgnehBBfvhChAK/oN4J3IUT5rwAq8iXdF0QsKCF1Fcve4JOJ3RnY3rkrSh9POAFWp38/DecSf+4riGmayqZpRtsZJ4BP5ISQ0xdWACmlembKcDGrtNUJFwDldl8YaxZcAOirpn/vMqQRYDXfXyzAet54DUaArusuAKDcn2IdC4CIVV3XA1m8TOGlzMAJcGbgzIB3BhI1odcLXweVimpKb5Uwtfh2PlCZ0CEogOgGZCpuVGN6A+j7PlX9Jzk459V2wzkRpehEUSMZdZj6LwCAQY9uD3xQBgyzgnX0MvpiDyX1jYLI8/yKiOM8zz+u6Tc5QCi4fu4BYqi8IW8/kVgAAAAASUVORK5CYII=",
		eye: "AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdnZ0Anp6eAZubmwibm5sSnJycGZubmxqbm5sSmpqaCZycnAGcnJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJycnACbm5sCm5ubH5ubm1qbm5uOm5ubuZubm8ybm5vZm5ub2pub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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////////////////////8A///4AB//4AAH/8AAA/+AAAH/Af+A/gfD4HwPgfA8HwD4OD4AfBg+AHwYPgB8GD4AfBwfAPg8D4HwPgfD4H8B/4D/gAAB/8AAA//gAAf/+AAf//8A////////////////////////////8=",
		shield: "data:image/x-icon;base64,AAABAAEAGBgAAAEAIACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACXl5cgmpqaYJubm7+cnJzfmpqaYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJqammCcnJzfm5ub/5ubm/+bm5v/m5ub/5ycnN+amppgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAm5ubf5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/mpqaYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5t/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ycnJ8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJqammCbm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5t/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAl5eXIJubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnJycn5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/nJycnwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACXl5cgm5ub/5ubm/+bm5v/m5ub/5ubm/+bm5tAm5ub/5ubm/+bm5v/nJyc35ycnJ+bm5v/m5ub/5ubm/+bm5v/m5ub/5eXlyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5t/m5ub/5ubm/+bm5v/m5ub/5ubm/+amppgAAAAAJubm3+bm5t/AAAAAJubm0Cbm5v/m5ub/5ubm/+bm5v/m5ub/5qammAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5t/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5t/AAAAAAAAAAAAAAAAAAAAAJubm3+bm5v/m5ub/5ubm/+bm5v/m5ub/5ycnJ8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5u/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5t/AAAAAAAAAAAAAAAAAAAAAJycnJ+bm5v/m5ub/5ubm/+bm5v/m5ub/5ycnJ8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcnJzfm5ub/5ubm/+bm5v/m5ub/5ubm38AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcnJyfm5ub/5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5v/m5ub/5ubm/+bm5v/nJycnwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAm5ubf5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+cnJzfm5ubvwAAAAAAAAAAnJycn5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5eXlyCXl5cgm5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ycnJ+cnJyfm5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACXl5cgnJycn5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+cnJzfnJycn5ubm0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJeXlyCbm5t/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/nJyc35ubm3+Xl5cgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAl5eXIJubm3+cnJzfm5ub/5ubm/+bm5v/m5ub/5ycnN+bm5t/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmpqaYJycnN+cnJzfmpqaYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A/4P/AP8A/wD+AH8A/AA/APgAHwDwAB8A8AAPAOAABwDgJAcA4DwHAOA8BwDgfgcA4P8HAOAYBwDgAAcA4AAHAOAABwDgAAcA4AAHAPgAHwD+AP8A/8P/AP///wA=",
		transparent: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=",
	}

	if icons.HasOwnProp(name) {
		iconHandler := Base64ToIcon(icons.%name%, debug)
		if (iconHandler) {
			e := false
			try {
				TraySetIcon("HICON:*" hICON := iconHandler)
			} catch Error as e {
				if (debug)
					MsgBox e.message
			}
		}
	}
}

Base64ToIcon(base64string, debug := false) {
	try {
		iconHandler := ImagePutHIcon({image: CleanBase64(base64string)})
	} catch Error as e {
		if (debug)
			MsgBox e.message
		return false
	}

	return iconHandler
}

CleanBase64(b64str) {
	if InStr(b64str, ",") {
		parts := StrSplit(b64str, ",", 2)
		if parts.Length == 2 and InStr(parts[1], "data") and StrLen(parts[2]) > 2
			return parts[2]
	}
	return b64str
}
